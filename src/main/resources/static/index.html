<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–û–±—É–≤–Ω–æ–π –º–∞–≥–∞–∑–∏–Ω</title>

    <style>
        :root {
            --bg: #f3f3f3;
            --text: #222;
            --card: #ffffff;
            --accent: #4a7df2;
            --accent-dark: #3468e0;
        }

        [data-theme="dark"] {
            --bg: #1c1c1c;
            --text: #e0e0e0;
            --card: #2b2b2b;
        }

        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: var(--bg);
            color: var(--text);
            transition: 0.3s;
        }

        header {
            padding: 20px;
            background: var(--accent);
            color: white;
            font-size: 26px;
            text-align: center;
            letter-spacing: 1px;
        }

        .theme-switch {
            position: absolute;
            top: 20px;
            right: 25px;
            cursor: pointer;
            background: rgba(255,255,255,0.15);
            padding: 8px 16px;
            border-radius: 20px;
            transition: 0.2s;
        }

        .theme-switch:hover {
            background: rgba(255,255,255,0.25);
        }

        .container {
            max-width: 1000px;
            margin: 25px auto;
            padding: 15px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
        }

        .tab {
            padding: 10px 25px;
            background: var(--card);
            border-radius: 8px;
            cursor: pointer;
            transition: 0.2s;
            font-weight: 600;
        }

        .tab.active {
            background: var(--accent);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .card {
            background: var(--card);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            animation: fade 0.4s ease;
        }

        @keyframes fade {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }


        /* –§–æ—Ä–º—ã */
        form {
            display: grid;
            gap: 12px;
            max-width: 500px;
        }

        input {
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #aaa;
            background: var(--bg);
            color: var(--text);
        }

        button {
            padding: 10px 15px;
            border: none;
            background: var(--accent);
            color: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 15px;
            transition: 0.25s;
            font-weight: 600;
        }

        button:hover {
            background: var(--accent-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        button:active {
            transform: translateY(0);
            box-shadow: none;
        }

        /* –¢–∞–±–ª–∏—Ü—ã */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        th, td {
            padding: 10px;
            border-bottom: 1px solid #999;
            text-align: left;
        }

        th {
            background: var(--accent);
            color: white;
        }

        /* Toast */
        #toast {
            position: fixed;
            bottom: 25px;
            right: 25px;
            background: var(--accent);
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            opacity: 0;
            pointer-events: none;
            transition: 0.4s;
            font-size: 15px;
        }

        #toast.show {
            opacity: 1;
            pointer-events: auto;
        }

    </style>
</head>
<body>

<header>–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –æ–±—É–≤–Ω–æ–≥–æ –º–∞–≥–∞–∑–∏–Ω–∞</header>

<div class="theme-switch" onclick="toggleTheme()">üåì –¢–µ–º–∞</div>

<div class="container">

    <div class="tabs">
        <div class="tab active" data-tab="products">–¢–æ–≤–∞—Ä—ã</div>
        <div class="tab" data-tab="sales">–ü—Ä–æ–¥–∞–∂–∏</div>
        <div class="tab" data-tab="addProduct">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</div>
        <div class="tab" data-tab="addSale">–û—Ñ–æ—Ä–º–∏—Ç—å –ø—Ä–æ–¥–∞–∂—É</div>
    </div>

    <div id="content"></div>
</div>

<div id="toast"></div>


<script>
/* ---------------------- –¢–µ–º—ã ---------------------- */
function toggleTheme() {
    const current = document.body.getAttribute("data-theme");
    document.body.setAttribute("data-theme", current === "dark" ? "light" : "dark");
}

/* ---------------------- Toast ---------------------- */
function toast(msg, error = false) {
    const t = document.getElementById("toast");
    t.textContent = msg;
    t.style.background = error ? "#d9534f" : "var(--accent)";
    t.classList.add("show");
    setTimeout(() => t.classList.remove("show"), 2500);
}

/* ---------------------- Tabs ---------------------- */
document.querySelectorAll(".tab").forEach(t => {
    t.addEventListener("click", () => {
        document.querySelectorAll(".tab").forEach(el => el.classList.remove("active"));
        t.classList.add("active");
        loadTab(t.dataset.tab);
    });
});

/* ---------------------- –ó–∞–≥—Ä—É–∑–∫–∞ –≤–∫–ª–∞–¥–æ–∫ ---------------------- */

function loadTab(tab) {
    const c = document.getElementById("content");

    if (tab === "products") {
        c.innerHTML = `
            <div class="card">
                <h2>–ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤</h2>
                <button onclick="loadProducts()">–û–±–Ω–æ–≤–∏—Ç—å</button>
                <table id="productTable"></table>
            </div>`;
        loadProducts();
    }

    if (tab === "sales") {
        c.innerHTML = `
            <div class="card">
                <h2>–ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–¥–∞–∂</h2>
                <button onclick="loadSales()">–û–±–Ω–æ–≤–∏—Ç—å</button>
                <table id="salesTable"></table>
            </div>`;
        loadSales();
    }

    if (tab === "addProduct") {
        c.innerHTML = `
            <div class="card">
                <h2>–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</h2>
                <form id="productForm">
                    <input id="pName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" required>
                    <input type="number" id="pSize" placeholder="–†–∞–∑–º–µ—Ä" required>
                    <input type="number" id="pPrice" placeholder="–¶–µ–Ω–∞" required>
                    <input type="number" id="pStock" placeholder="–û—Å—Ç–∞—Ç–æ–∫" required>
                    <button type="submit">–î–æ–±–∞–≤–∏—Ç—å</button>
                </form>
            </div>`;
        productForm.onsubmit = addProduct;
    }

    if (tab === "addSale") {
        c.innerHTML = `
            <div class="card">
                <h2>–û—Ñ–æ—Ä–º–∏—Ç—å –ø—Ä–æ–¥–∞–∂—É</h2>
                <form id="saleForm">
                    <input id="sProductId" placeholder="ID —Ç–æ–≤–∞—Ä–∞" required>
                    <input type="number" id="sQty" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ" required>
                    <button type="submit">–ü—Ä–æ–¥–∞—Ç—å</button>
                </form>
            </div>`;
        saleForm.onsubmit = addSale;
    }
}

/* ---------------------- API ---------------------- */

async function loadProducts() {
    const res = await fetch("/api/products");
    const data = await res.json();

    const tbl = document.getElementById("productTable");
    tbl.innerHTML = `
        <tr><th>ID</th><th>–ù–∞–∑–≤–∞–Ω–∏–µ</th><th>–†–∞–∑–º–µ—Ä</th><th>–¶–µ–Ω–∞</th><th>–û—Å—Ç–∞—Ç–æ–∫</th></tr>
        ${data.map(p => `
            <tr>
                <td>${p.id}</td>
                <td>${p.name}</td>
                <td>${p.size}</td>
                <td>${p.price}</td>
                <td>${p.stock}</td>
            </tr>`).join("")}
    `;
}

async function loadSales() {
    const res = await fetch("/api/sales");
    const data = await res.json();

    const tbl = document.getElementById("salesTable");
    tbl.innerHTML = `
        <tr><th>ID</th><th>ID —Ç–æ–≤–∞—Ä–∞</th><th>–ö–æ–ª-–≤–æ</th><th>–°—É–º–º–∞</th><th>–î–∞—Ç–∞</th></tr>
        ${data.map(s => `
            <tr>
                <td>${s.id}</td>
                <td>${s.productId}</td>
                <td>${s.quantity}</td>
                <td>${s.totalPrice}</td>
                <td>${new Date(s.timestamp).toLocaleString("ru-RU")}</td>
            </tr>`).join("")}
    `;
}

async function addProduct(e) {
    e.preventDefault();
    const body = {
        name: pName.value,
        size: Number(pSize.value),
        price: Number(pPrice.value),
        stock: Number(pStock.value)
    };

    const res = await fetch("/api/products", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(body)
    });

    toast(res.ok ? "–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω" : "–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è", !res.ok);

    if (res.ok) e.target.reset();
}

async function addSale(e) {
    e.preventDefault();
    const body = {
        productId: sProductId.value,
        quantity: Number(sQty.value)
    };

    const res = await fetch("/api/sales", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(body)
    });

    const ok = res.ok;
    const msg = ok ? "–ü—Ä–æ–¥–∞–∂–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∞" : (await res.json()).error;

    toast(msg, !ok);

    if (ok) e.target.reset();
}

/* –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–≤—É—é –≤–∫–ª–∞–¥–∫—É */
loadTab("products");

</script>
</body>
</html>